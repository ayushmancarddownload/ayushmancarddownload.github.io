name: Auto IndexNow Submit

on:
  push:
    branches:
      - main
      - master

jobs:
  submit-indexnow:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Generate URL list
      run: |
        SITE_URL="https://ayushmancarddownload.github.io"
        echo "[" > urls.json
        find . -name "*.html" | while read file; do
          CLEAN=$(echo "$file" | sed 's|./||')
          echo "\"$SITE_URL/$CLEAN\"," >> urls.json
        done
        sed -i '$ s/,$//' urls.json
        echo "]" >> urls.json

    - name: Send to IndexNow
      run: |
        API_KEY="039c6529eea94ac8a53a30c3a1b6a17d"
        SITE_URL="ayushmancarddownload.github.io"

        curl -X POST "https://www.bing.com/indexnow" \
        -H "Content-Type: application/json" \
        -d "{
          \"host\": \"$SITE_URL\",
          \"key\": \"$API_KEY\",
          \"urlList\": $(cat urls.json)
        }"
